---
interface Props {
  value: number;
  max?: number;
  size?: number;
  strokeWidth?: number;
  label?: string;
  sublabel?: string;
  color?: 'green' | 'orange' | 'red' | 'white';
}

const {
  value,
  max = 100,
  size = 120,
  strokeWidth = 8,
  label,
  sublabel,
  color = 'green',
} = Astro.props;

const percentage = Math.min(100, Math.max(0, (value / max) * 100));
const radius = (size - strokeWidth) / 2;
const circumference = 2 * Math.PI * radius;
const offset = circumference - (percentage / 100) * circumference;

const colors = {
  green: '#30d158',
  orange: '#ff9500',
  red: '#ff3b30',
  white: '#ffffff',
};

const strokeColor = colors[color];
const chartId = `ring-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="ring-wrapper" style={`width: ${size}px; height: ${size}px;`}>
  <svg
    class="ring-svg"
    viewBox={`0 0 ${size} ${size}`}
  >
    <!-- Background ring -->
    <circle
      cx={size / 2}
      cy={size / 2}
      r={radius}
      fill="none"
      stroke="var(--border, #2a2a2a)"
      stroke-width={strokeWidth}
    />

    <!-- Progress ring -->
    <circle
      id={chartId}
      cx={size / 2}
      cy={size / 2}
      r={radius}
      fill="none"
      stroke={strokeColor}
      stroke-width={strokeWidth}
      stroke-linecap="round"
      stroke-dasharray={circumference}
      stroke-dashoffset={offset}
      class="progress-ring"
      style={`--color: ${strokeColor};`}
    />

    <!-- Glow effect -->
    <circle
      cx={size / 2}
      cy={size / 2}
      r={radius}
      fill="none"
      stroke={strokeColor}
      stroke-width={strokeWidth + 4}
      stroke-linecap="round"
      stroke-dasharray={circumference}
      stroke-dashoffset={offset}
      class="progress-glow"
      opacity="0.2"
    />
  </svg>

  <div class="ring-content">
    <div class="ring-value" style={`color: ${strokeColor};`}>
      {Math.round(value)}
    </div>
    {label && <div class="ring-label">{label}</div>}
    {sublabel && <div class="ring-sublabel">{sublabel}</div>}
  </div>
</div>

<style>
  .ring-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ring-svg {
    transform: rotate(-90deg);
    position: absolute;
    top: 0;
    left: 0;
  }

  .progress-ring {
    transition: stroke-dashoffset 0.6s ease;
    filter: drop-shadow(0 0 6px var(--color));
  }

  .progress-glow {
    filter: blur(4px);
  }

  .ring-content {
    text-align: center;
    z-index: 1;
  }

  .ring-value {
    font-family: var(--font-display, 'Orbitron', sans-serif);
    font-size: 1.75rem;
    font-weight: 700;
    line-height: 1;
  }

  .ring-label {
    font-family: var(--font-body, 'Space Grotesk', monospace);
    font-size: 0.65rem;
    color: var(--text-secondary, #a0a0a0);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 0.25rem;
  }

  .ring-sublabel {
    font-family: var(--font-body, 'Space Grotesk', monospace);
    font-size: 0.6rem;
    color: var(--text-muted, #606060);
    margin-top: 0.125rem;
  }
</style>
